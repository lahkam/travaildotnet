<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>isgasoir — Interface</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#f5f7fb;color:#0f172a}
    header{background:#fff;padding:12px 16px;border-bottom:1px solid #e6eef8}
    .app{display:flex;height:calc(100vh - 56px)}
    nav{width:220px;background:#fff;border-right:1px solid #e6eef8;padding:12px}
    main{flex:1;padding:16px;overflow:auto}
    button{display:block;margin:6px 0;padding:8px;border-radius:6px;border:1px solid #dbeafe;background:#fff;color:#1f6feb;cursor:pointer}
    .sect{background:#fff;padding:12px;border-radius:6px}
    .item{padding:8px;border-bottom:1px solid #eef2f6}
    pre{white-space:pre-wrap}
  </style>
</head>
<body>
  <header>
    <strong>isgasoir</strong>
  </header>
  <div class="app">
    <nav>
      <button id="nav-filieres">Filières</button>
      <button id="nav-semestres">Semestres</button>
      <button id="nav-modules">Modules</button>
      <button id="nav-chapitres">Chapitres</button>
      <button id="nav-activites">Activités</button>
      <button id="nav-hierarchy">Structure</button>
      <div style="margin-top:12px;color:#6b7280;font-size:13px">UI simplifiée pour debug</div>
    </nav>
    <main>
      <div id="content" class="sect">Chargement...</div>
    </main>
  </div>

  <script>
    (function(){
      function safeFetchJson(path){
        return fetch(path, { headers: { 'Accept': 'application/json' } }).then(function(r){ if(!r.ok) throw new Error(r.status + ' ' + r.statusText); return r.json(); });
      }

      function renderList(title, items, formatter){
        var c = document.getElementById('content'); c.innerHTML='';
        var h = document.createElement('h2'); h.innerText = title; c.appendChild(h);
        if(!items || items.length===0){ var p = document.createElement('div'); p.innerText='Aucun élément'; c.appendChild(p); return; }
        items.forEach(function(it){ var d = document.createElement('div'); d.className='item'; d.innerText = formatter ? formatter(it) : JSON.stringify(it); c.appendChild(d); });
      }

      function renderFilieres(){ safeFetchJson('/api/filiere').then(function(list){ renderList('Filières', list, function(f){ return f.name + ' — ' + (f.description||''); }); }).catch(showError); }
      function renderSemestres(){ safeFetchJson('/api/semestre').then(function(list){ renderList('Semestres', list, function(s){ return s.name + ' — FiliereId:' + (s.filiereId||''); }); }).catch(showError); }
      function renderModules(){ safeFetchJson('/api/modules').then(function(list){ renderList('Modules', list, function(m){ return m.name + ' — Coeff:' + (m.coiff||m.coeff||''); }); }).catch(showError); }
      function renderChapitres(){ safeFetchJson('/api/chapitres').then(function(list){ renderList('Chapitres', list, function(ch){ return ch.title + ' — Durée:' + (ch.duree||''); }); }).catch(showError); }
      function renderActivities(){ safeFetchJson('/api/activities').then(function(list){ renderList('Activités', list, function(a){ return a.title + ' — ChapitreId:' + (a.chapitreId||''); }); }).catch(showError); }
      function renderHierarchy(){ safeFetchJson('/api/filiere').then(function(list){ var c = document.getElementById('content'); c.innerHTML=''; var h = document.createElement('h2'); h.innerText = 'Structure hiérarchique'; c.appendChild(h); list.forEach(function(f){ var d = document.createElement('div'); d.className='item'; var t = document.createElement('div'); t.innerText = f.name + ' — ' + (f.description||''); d.appendChild(t); var btn = document.createElement('button'); btn.innerText = 'Afficher détails'; btn.style.display='inline-block'; btn.onclick = function(){ safeFetchJson('/api/filiere/' + f.id).then(function(full){ var pre = document.createElement('pre'); pre.innerText = JSON.stringify(full, null, 2); d.appendChild(pre); }).catch(showError); }; d.appendChild(btn); c.appendChild(d); }); }).catch(showError); }

      function showError(e){ var c = document.getElementById('content'); c.innerHTML = ''; var d = document.createElement('div'); d.style.color = '#c00'; d.innerText = 'Erreur: ' + (e && e.message ? e.message : String(e)); c.appendChild(d); console.error(e); }

      // attach events robustly
      function wire(){
        var el;
        el = document.getElementById('nav-filieres'); if(el) el.addEventListener('click', renderFilieres);
        el = document.getElementById('nav-semestres'); if(el) el.addEventListener('click', renderSemestres);
        el = document.getElementById('nav-modules'); if(el) el.addEventListener('click', renderModules);
        el = document.getElementById('nav-chapitres'); if(el) el.addEventListener('click', renderChapitres);
        el = document.getElementById('nav-activites'); if(el) el.addEventListener('click', renderActivities);
        el = document.getElementById('nav-hierarchy'); if(el) el.addEventListener('click', renderHierarchy);
      }

      if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', wire); else wire();
      // initial
      renderFilieres();
    })();
  </script>
</body>
</html>

